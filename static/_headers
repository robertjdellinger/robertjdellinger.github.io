# netlify.toml

# Global defaults, overridden by more specific blocks below
[[headers]]
for = "/*"
  [headers.values]
  X-Frame-Options = "DENY"
  X-Content-Type-Options = "nosniff"
  Referrer-Policy = "strict-origin-when-cross-origin"
  # X-XSS-Protection is deprecated, safe to omit, keep only if you need legacy IE behavior
  # X-XSS-Protection = "1; mode=block"

  # Permissions Policy, lock everything by default
  Permissions-Policy = "accelerometer=(), camera=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=()"

  # Content Security Policy, tuned for HugoBlox, KaTeX, Mermaid, Pagefind, and your current snippets
  # If you add analytics, allow their domains in script-src and connect-src
  Content-Security-Policy = "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://buttons.github.io https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.jsdelivr.net; font-src 'self' data: https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' https:; frame-ancestors 'none'; base-uri 'self'; form-action 'self'"

  # Long cache by default for static assets, specific overrides below will correct HTML
  Cache-Control = "public, max-age=31536000, immutable"

# HTML must not be cached long, so users see updates
[[headers]]
for = "/*.html"
  [headers.values]
  Cache-Control = "public, max-age=0, must-revalidate"

# CSS
[[headers]]
for = "/*.css"
  [headers.values]
  Cache-Control = "public, max-age=31536000, immutable"

# JS
[[headers]]
for = "/*.js"
  [headers.values]
  Cache-Control = "public, max-age=31536000, immutable"

# Fonts
[[headers]]
for = "/fonts/*"
  [headers.values]
  Cache-Control = "public, max-age=31536000, immutable"
  Access-Control-Allow-Origin = "*"

# Images and icons under /media
[[headers]]
for = "/media/*"
  [headers.values]
  Cache-Control = "public, max-age=31536000, immutable"

# Your uploads, like PDFs
[[headers]]
for = "/uploads/*"
  [headers.values]
  Cache-Control = "public, max-age=31536000, immutable"
